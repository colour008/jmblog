---
title: 基于OpenWrt udpxy 插件实现IPTV全平台观看📺 
date: 2024-12-02 10:00:00
updated: 2024-12-02 10:00:00
tag: [教程,OpenWrt,IPTV]
categories: [知识库,OpenWrt]
cover:
description: 基于OpenWrt udpxy 插件实现IPTV全平台观看📺
swiper_index: 
sticky:  
---

---

# 方案优势和网络拓扑

该方案不需要拿到光猫管理员（虽然折腾半天拿到了发现可以不用），也不需要设置 VLAN，因为是双线接入只会多占用一个软路由端口，简单几步配置就能支持 IPTV。具体网络拓扑图如下：

![img](https://bu.dusays.com/2024/12/08/675521bd5f8b1.png)

简单介绍一下拓扑情况，光纤入户通过光猫再到安装 OpenWrt 的软路由，光猫使用桥接通过 OpenWrt 拔号上网（光猫使用路由模式直接拔号也没有影响）。光猫的上网口接入软路由的 WAN（eth0）口，IPTV 接入软路由的 eth1，后面会进行配置，还有一个 Wifi 作为 AP 让其它设备接入。

# 准备工作

- 光猫 1 台，需要开通 IPTV 服务；
- 软路由 1 台，至少 3 个网口以上，博主使用的是一台 `J4125` 4 网口软路由，并已刷 `esir` 高大全` OpenWrt R23.3.3 GDQ V1[2023]` 系统；
- 电脑或手机 1 台，用于配置相关设置。

# 方法 / 步骤

## 1. 获取本地 IPTV 组播源地址

博主这里是甘肃电信，组播源地址我是从恩山论坛找的 (原帖地址为 https://www.right.com.cn/forum/thread-8291004-1-3.html)，因为博主之前把自家的电信机顶盒刷了第三方系统，不能抓包了。抓包方法可自行百度，也可参照 B 站 up 主 [科技宅小明](https://space.bilibili.com/5626102)的这期视频教程[【硬核】干掉 IPTV，随时随地看电视，超清无开机广告！](https://www.bilibili.com/video/BV1Ka411W7Hf/?spm_id_from=333.337.search-card.all.click&vd_source=c5a46efcbe68c08701ad742bbbd03c4e)。获取的组播源地址经过整理后如下：

```CSS
CCTV-1,rtp://239.255.30.1:8231
CCTV-2,rtp://239.255.30.2:8231
爱综艺,rtp://239.255.30.185:8231
CCTV-4,rtp://239.255.30.3:8231
爱体育,rtp://239.255.30.186:8231
爱电影,rtp://239.255.30.187:8231
CCTV-7,rtp://239.255.30.4:8231
爱大剧,rtp://239.255.30.188:8231
CCTV-9,rtp://239.255.30.74:8231
CCTV-10,rtp://239.255.30.6:8231
CCTV-11,rtp://239.255.30.7:8231
CCTV-12,rtp://239.255.30.8:8231
CCTV-新闻,rtp://239.255.30.9:8231
CCTV-少儿,rtp://239.255.30.10:8231
CCTV-音乐,rtp://239.255.30.11:8231
CCTV-17,rtp://239.255.30.95:8231
CCTV-NEWS,rtp://239.255.30.5:8231
CCTV-16 4K,rtp://239.255.30.80:8231
```

## 2. 设置软路由

### 2-1 释放网口

在 `网络 -> 接口 `中找到 `LAN` 编辑，在物理设置里面把用于 IPTV 的物理端口 `eth1` 取消勾选。

### 2-2 新建 IPTV 接口

- 在 `网络 -> 接口` 中创建新接口，命名 `IPTV`（其它名字也可以方便记忆），协议选择`静态 IP`。配置 IP 地址，不要和你当前路由同一网段就行，博主路由器的网段是 `192.168.5.x`，所以博主把 `IPTV` 的网段设置为 `192.168.2.1` 。
- 然后在`高级设置`里面把跃点数设置为 `50` ，`WAN` 口设置的 `20`。
- 在`物理设置` 里面选择刚刚释放用于 IPTV 的 `eth1`。
- 最后在 `防火墙` 里新建一个 `iptv` ，保存并应用。

>注意：新建防火墙后观察iptv对应的入站数据、出站数据及转发是否为接受，如果不是，请务必全部改过来，要不然也无法播放成功。如下图：

![image-20250510120151018](https://bu.dusays.com/2025/05/10/681ecfb6a2e2e.png)

### 2-3 启用 udpxy 插件

因为博主使用的 OpenWrt 固件中已经集成 `udpxy`，所以可以直接使用，如果未集成需要到 `系统 -> 软件` 中进行安装。
进入 `服务 -> udpxy`，点击`启用`，在`绑定 IP/接口` 处填写 OpenWrt 软路由 IP 或者 `0.0.0.0` 也可以，`源 IP/接口` 使用上面的 IPTV 的接口 `eth1`，保存并应用。

### 2-4 验证 udpxy 是否启用成功

在浏览器输入 `http://<router-ip>:4022/status` 如果看到如下图界面，说明配置成功。这里的 `router-ip` 即为你的软路由的 ip 地址（博主的是 `192.168.5.1`），也是图中接受客户端的地址。组播地址 `192.168.2.1` 即为上面 IPTV 接口配置的静态 IP。

![img](https://bu.dusays.com/2024/12/08/675521dd0cc59.jpg)

## 3. 播放验证

将抓包的 `IPTV` 本地组播源（例如博主这里的 CCTV-1,`rtp://239.255.30.1:8231`）修改为 `http://192.168.5.1:4022/udp/239.255.30.101:8231`，`192.168.5.1` 即为博主的路由器 IP，使用 PotPlayer 播放器或 VLC 播放器打开该 URL 链接 即可正常播放，如下图：

![img](https://bu.dusays.com/2024/12/08/6755220c9ef66.jpg)

部分 `m3u` 文件中的地址是 `igmp://x.x.x.x:x` ，只需要把协议去掉在前面加上 `http://<router-ip>:4022/udp` 就可以，最终播放地址是 `http://<router-ip>:4022/udp/x.x.x.x:x`。

单个测试成功之后，就可以利用记事本软件的查找替换功能批量修改替换 `m3u` 中的地址，使用播放器加载修改后的文件。替换后如下：

```CSS
CCTV-1,http://192.168.5.1:4022/udp/239.255.30.1:8231
CCTV-2,http://192.168.5.1:4022/udp/239.255.30.2:8231
爱综艺,http://192.168.5.1:4022/udp/239.255.30.185:8231
CCTV-4,http://192.168.5.1:4022/udp/239.255.30.3:8231
爱体育,http://192.168.5.1:4022/udp/239.255.30.186:8231
爱电影,http://192.168.5.1:4022/udp/239.255.30.187:8231
CCTV-7,http://192.168.5.1:4022/udp/239.255.30.4:8231
爱大剧,http://192.168.5.1:4022/udp/239.255.30.188:8231
CCTV-9,http://192.168.5.1:4022/udp/239.255.30.74:8231
CCTV-10,http://192.168.5.1:4022/udp/239.255.30.6:8231
CCTV-11,http://192.168.5.1:4022/udp/239.255.30.7:8231
CCTV-12,http://192.168.5.1:4022/udp/239.255.30.8:8231
```

如果你整理的组播源地址是类似上述的 `txt` 格式的文本文件，你可以全选直播源，打开黑鸟博客的直播源列表格式在线转换 https://guihet.com/tvlistconvert.html，粘贴文本后点击转 M3U。

![img](https://bu.dusays.com/2024/12/08/6755222d132a0.jpg)

转换完成后点击下载，即可生成一个 `tvlist.m3u` 的文件，直接使用 PotPlayer 播放器或 VLC 播放器打开即可观看所有节目。转换后的结果如下：

```CSS
#EXTM3U
#EXTINF:-1,CCTV-1
http://192.168.5.1:4022/udp/239.255.30.1:8231
#EXTINF:-1,CCTV-2
http://192.168.5.1:4022/udp/239.255.30.2:8231
#EXTINF:-1,爱综艺
http://192.168.5.1:4022/udp/239.255.30.185:8231
#EXTINF:-1,CCTV-4
http://192.168.5.1:4022/udp/239.255.30.3:8231
#EXTINF:-1,爱体育
http://192.168.5.1:4022/udp/239.255.30.186:8231
#EXTINF:-1,爱电影
http://192.168.5.1:4022/udp/239.255.30.187:8231
#EXTINF:-1,CCTV-7
http://192.168.5.1:4022/udp/239.255.30.4:8231
#EXTINF:-1,爱大剧
http://192.168.5.1:4022/udp/239.255.30.188:8231
#EXTINF:-1,CCTV-9
http://192.168.5.1:4022/udp/239.255.30.74:8231
#EXTINF:-1,CCTV-10
http://192.168.5.1:4022/udp/239.255.30.6:8231
#EXTINF:-1,CCTV-11
http://192.168.5.1:4022/udp/239.255.30.7:8231
#EXTINF:-1,CCTV-12
http://192.168.5.1:4022/udp/239.255.30.8:8231
```

# 挖坑

如何在多端轻松观看及推荐软件下载，博主后面将再补一篇专题文章进行说明演示，敬请期待。。。

另外有任何问题，可在评论区提出，博主看到后将会在第一时间回复哒…☕